# bed-intersect

For analysis of `.bed` file intersections

## Objective

Find intersection percentage for all pairwise combinations of a set of `.bed` files.

## Quickstart

### HiPerGator

```
$ module load python
$ module load bedtools
$ cd bedintersect/scripts
$ python bed_intersect.py
Enter slop size (+/- n base pairs on each side):
Enter table results filename:
Enter threshold for filtered results (0-100):
Enter filtered results filename:
```

## Data

* `.bed` files for samples
* `dm6.chrom.sizes` (from [UCSC dataset](http://hgdownload.cse.ucsc.edu/goldenPath/dm6/bigZips/))

See section **Directory tree**

## Dependencies

1. `bedtools` ([docs](http://bedtools.readthedocs.io/en/latest/index.html))
2. `numpy` ([docs](http://pythonhosted.org/pybedtools/index.html))
3. `pybedtools` ([docs](http://pythonhosted.org/pybedtools/index.html))

There are 2 ways to set up the dependencies needed.

### 1. Load with HPG modules

```
module load python
module load bedtools
```

### 2. Add to virtualenv

Using `pip`:

```
pip install numpy
pip install cython
pip install pybedtools
```

## Calculation

For each (row, column) pair, the intersection percentage is calculated in the following manner:

`row.intersect(column).count() / row.count()`

where the intersect is computed using `-u` in `bedtools`:
> Write the original [row] entry **once** if **any** overlaps found in [column].

### Slop

The slop option can be specified (from [bedtools docs](http://bedtools.readthedocs.io/en/latest/content/tools/slop.html)):
> Increase the BED/GFF/VCF entry -b base pairs in each direction.

## Output files

### Table

Table format stores all intersect percentages rounded to 2 decimal points.

### Filtered results

Results can be filtered to be displayed in a three-column format (`file1`, `file2`, `file1.intersect(file2)_percent`), given a threshold.

### Intersect files

Individual intersect files are stored in `results/intersects/`.

## Directory tree

The following directory tree is assumed/generated by `bed_intersect.py`:

```
BASE_DIR
│
├───scripts
│   │   bed_intersect.py
│
├───data
│   │   dm6.chrom.sizes
│   │
│   └───Beds
│       │   Kc167_P53_NT60B_peaks.bed
│       │   Kc167_P53_XR60B_peaks.bed
│       │   ...
│       │
│
│
└───results
    │   [summary files]
    │
    └───intersects
        │   [intersect files]
        │   ...
        │
```
